<replace with full canvas code above>